name: 'Fastlane Android'
description: 'Execute fastlane pipeline for Android'
inputs:
  enforced-branch:
    description: 'Branch to enforce, recommended (supports regex)'
    required: false
  commit-increment:
    description: 'Whether or not to commit and push version increment'
    required: false
    default: 'false'
  publish-build:
    description: 'Whether or not to publish build artifacts to the Play Store'
    required: false
    default: 'true'
  package-name:
    description: 'Android app package name (e.g. com.example.application)'
    required: true
  google-json-key-base64:
    description: 'Google Credentials JSON contents in base64 to upload artifacts (required if publishing is enabled)'
    required: false
  artifact:
    description: 'The type of the artifact that should be produced (values: apk, aab [default])'
    required: false
    default: 'aab'
  flavor:
    description: 'The build flavor that should be used'
    required: false
  build-type:
    description: 'The build type that should be used'
    required: false
    default: 'Release'
  skip-signing:
    description: 'Whether or not to skip build signing (may not work if `build-type` is Release)'
    required: false
    default: 'false'
  key-store-base64:
    description: 'Android Keystore data contents in base64 (required if signing is enabled)'
    required: false
  key-store-password:
    description: 'Android Keystore password (required if signing is enabled)'
    required: false
  key-alias:
    description: 'Android Keystore key alias (required if signing is enabled)'
    required: false
  key-password:
    description: 'Android Keystore key password (required if signing is enabled)'
    required: false
runs:
  using: 'composite'
  steps:
    - uses: ruby/setup-ruby@v1
      with:
        ruby-version: '3.1.2'
        bundler-cache: true
    - id: create-google-json-file
      if: ${{ inputs.google-json-key-base64 != '' }}
      shell: bash
      run: |
        echo "${{ inputs.google-json-key-base64 }}" | base64 -d > __google_credentials.json
        echo "google-credentials-file=$(pwd)/__google_credentials.json" >> $GITHUB_OUTPUT
    - id: create-keystore-file
      if: ${{ inputs.key-store-base64 != '' }}
      shell: bash
      run: |
        echo "${{ inputs.key-store-base64 }}" | base64 -d > __keystore.jks 
        echo "keystore-file=$(pwd)/__keystore.jks" >> $GITHUB_OUTPUT
